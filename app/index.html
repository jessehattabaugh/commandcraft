<!DOCTYPE html>
<html>
<head>
  <title>CommandCraft</title>
  <style type="text/css">
    section:not(:last-child) {
      border-bottom: 1px solid gray;
      margin-bottom: 1em;
    }

    input[type=number]{
      width: 3em;
    }
  </style>
</head>
<body>

  <form id="app">
  
    <section>
      <label>Command
        <select data-bind="
          options: commands,
          optionsText: 'id',
          value: selected.command
        "></select>
      </label>
    </section>
    
    <section data-bind="visible: selected.command().id == 'give'">
      
      <section>
        <label>Player
          <input data-bind="value: selected.player">
          <select data-bind="
            options: variables,
            optionsText: 'name',
            value: selected.player
            "></select>
        </label>
      </section>
      
      <section>
        <label>Item
          <select data-bind="
            options: items,
            optionsText: 'name',
            value: selected.item
          "></select>
        </label>
      </section>
      
      <section>
        <label>Amount
          <input type="number" min="1" max="64" data-bind="value: selected.amount">
        </label>
      </section>
      
      <section>
        <label>Metadata
          <input type="number" min="0" max="256" data-bind="value: selected.metadata">
        </label>
      </section>
      
    </section>
    
    <section data-bind="visible: selected.command().id == 'summon'">
      
      <section>
        <label>Entity
          <select data-bind="
            options: entities,
            optionsText: 'name',
            value: selected.entity
          "></select>
        </label>
      </section>
      
      <section>
        <fieldset>
          <legend>Coordinates</legend>
          
          <div>
            <label>X
              <input type="number" data-bind="value: selected.x">
            </label>
            <label>
              <input type="checkbox" data-bind="value: selected.xRelative"> relative
            </label>
          </div>
          
          <div>
            <label>Y
              <input type="number" min="0" max="256" data-bind="value: selected.y">
            </label>
            <label>
              <input type="checkbox" data-bind="value: selected.yRelative"> relative
            </label>
          </div>
          
          <div>
            <label>Z
              <input type="number" data-bind="value: selected.z">
            </label>
            <label>
              <input type="checkbox" data-bind="value: selected.zRelative"> relative
            </label>
          </div>
          
        </fieldset>
        
        <section>
        
        </section>
        
      </section>
      
    </section>
    
    <section>
      <label>Output
        <textarea style="width: 100%; height: 10em" data-bind="text: output"></textarea>
      </label>
    </section>
    
  </form>

  <script type="text/html" id="tagNode">
    <section>
      I'm a tag
    </section>
  </script>

  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/knockout/3.0.0/knockout-min.js"></script>
  <script type="text/javascript">

    function App() {
      var self = this;
      
      self.dataValues = {
      };
      
      self.commands = ko.observable({id: "Loading..."});
      $.get('commands', {}, function success(res) {
        self.commands(res);
      });
      
      self.variables = ko.observable();
      $.get('variables', {}, function success(res) {
        self.variables(res);
      });
      
      self.entities = ko.observable();
      $.get('entities', {}, function success(res) {
        self.entities(res);
      });
      
      self.items = ko.observable({id: "Loading..."});
      $.get('items', {}, function success(res) {
        self.items(res);
      });
      
      self.tags = ko.observable();
      $.get('tags', {}, function success(res) {
        self.tags(res);
      });
      
      // the command we are currently building
      self.selected = {
        command: ko.observable(''),
        player: ko.observable(''),
        entity: ko.observable(''),
        item: ko.observable(0),
        amount: ko.observable(1),
        metadata: ko.observable(0),
        x: ko.observable('0'),
        xRelative: ko.observable(false),
        y: ko.observable('0'),
        yRelative: ko.observable(false),
        z: ko.observable('0'),
        zRelative: ko.observable(false)
      };
      
      self.output = ko.computed(function compile(){
        var args = [self.selected.command().id];
        
        switch (args[0]) {
            
          case 'give':
            args = args.concat([
              self.selected.player(),
              self.selected.item().id,
              self.selected.amount(),
              self.selected.metadata()
            ]);
            break;
            
          case 'summon':
            args = args.concat([
              self.selected.entity().name,
              (self.selected.xRelative() ? '~' : '') + self.selected.x(),
              (self.selected.yRelative() ? '~' : '') + self.selected.y(),
              (self.selected.zRelative() ? '~' : '') + self.selected.z()
            ]);
            break;
        }
        
        return "/" + args.join(" ");
      });
     
    }
    var app = new App();
    ko.applyBindings(app, $('app')[0]);

  </script>
</body>
</html>